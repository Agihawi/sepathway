# Singularity definition for interproscan

bootstrap: docker
from: ubuntu:16.04

# To Build: sudo /opt/ohpc/pub/libs/singularity/3.2.1/bin/singularity build sepathway.sif sepathway.def 
%help
    A simple container to run interproscan

%environment
    PATH="$PATH:/usr/local/anaconda/bin/"
    PATH="$PATH:/interproscan/"
    PATH="$PATH:/interproscan/bin/"
%post
    apt-get update
    apt-get install -y eatmydata wget curl sudo nano perl elfutils
    apt-get install -y gfortran emboss
    eatmydata apt-get install -y bzip2
    apt-get clean
    # install interproscan
    wget ftp://ftp.ebi.ac.uk/pub/software/unix/iprscan/5/5.39-77.0/interproscan-5.39-77.0-64-bit.tar.gz
    tar -xzvf interproscan-5.39-77.0-64-bit.tar.gz
    mv interproscan-5.39-77.0 /interproscan
    #install anaconda
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ./anaconda.sh
    bash ./anaconda.sh -b -p /usr/local/anaconda ; rm ./anaconda.sh
    # set anaconda path
    export PATH="$PATH:/usr/local/anaconda/bin/"
    #configure conda
    conda config --add channels bioconda
    conda config --add channels r
    #install dependencies
    conda install python=3.6
    conda install pip
    conda install -c bioconda perl-bioperl
    conda install -c conda-forge openjdk
    #upgrade permissions to access database
    sudo chmod -R 777 /usr/local/anaconda/
    #House Keeping
    conda clean --tarballs

%runscript
    echo "Interproscan Singularity"
